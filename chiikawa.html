<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JIWUå‰ç‰©è²©å”®ï¼å¯¶å¯¶ç›®éŒ„</title>
  <link rel="icon" href="https://i.postimg.cc/3R7nNT0k/icon.png" type="image/png" />
  <style>
    :root { --theme-color: #d77485; }
    body {
      font-family: "Noto Sans TC", Arial, sans-serif;
      margin: 0;
      background: #f9f9f9;
      color: #333;
    }
    .top-bar {
      background: var(--theme-color);
      color: #fff;
      text-align: center;
      padding: 12px 10px;
      font-weight: 700;
      user-select: none;
      animation: bounce 1.2s ease-in-out infinite alternate;
      position: sticky;
      top: 0;
      z-index: 9999;
    }
    .top-bar a {
      color: #fff;
      text-decoration: none;
    }
    @keyframes bounce {
      0% { transform: scale(1); }
      100% { transform: scale(1.1); }
    }
    h1 {
      text-align: center;
      margin: 20px 0 10px;
      font-weight: 700;
    }
    .section-title {
      background: var(--theme-color);
      color: #fff;
      font-weight: 700;
      padding: 6px 12px;
      margin: 20px 10px 8px;
      border-radius: 6px;
      user-select: none;
      font-size: 1.1em;
    }
    .type-divider {
      display: flex;
      align-items: center;
      margin: 14px 0 8px;
      color: #666;
      user-select: none;
      font-weight: 600;
      font-size: 0.95em;
    }
    .type-divider::before,
    .type-divider::after {
      content: "";
      flex: 1;
      border-top: 1px solid #ccc;
      margin: 0 10px;
    }
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      padding: 0 10px 20px;
      justify-items: center;
    }
    .card {
      border: 2px solid var(--theme-color);
      border-radius: 8px;
      background: #fff;
      width: 150px;
      box-sizing: border-box;
      text-align: center;
      padding: 8px 6px;
      user-select: none;
      cursor: default;
      transition: box-shadow 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 4px 10px rgba(215, 116, 133, 0.6);
    }
    .card img {
      width: 100%;
      height: 120px;
      object-fit: contain;
      border-radius: 6px;
      user-select: none;
    }
    .card .name {
      font-weight: 700;
      margin: 8px 0 4px;
      font-size: 1em;
      color: #333;
    }
    .card .price {
      color: var(--theme-color);
      font-weight: 600;
      font-size: 0.9em;
      margin-bottom: 4px;
    }
    .card .stock {
      font-size: 0.85em;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <a href="https://lin.ee/X6FUFI9" target="_blank" rel="noopener noreferrer">è¨‚è³¼é€™é‚Šæ‰¾èŠ±èŠ± (à§¹Ë™ê’³Ë™à¸…)</a>
  </div>
  <h1>JIWUå‰ç‰©è²©å”®ï¼ã¡ã„ã‹ã‚</h1>

  <main id="content">è³‡æ–™è¼‰å…¥ä¸­...</main>

  <script>
  // âœ… Google è©¦ç®—è¡¨è³‡æ–™è¨­å®š
  const SHEET_ID = "1iCEqgnGGa_TVVbx90xNWxDzwKtz94VfqF8IsXRvpKMY";
  const SHEET_NAME = "ã¡ã„ã‹ã‚";
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

  // âœ… è§’è‰²é—œéµå­—å°æ‡‰
  const roleKeywords = {
    "å‰ä¼Š": "å‰",
    "å°å…«": "å…«",
    "å…”å…”": "å…”",
    "å°æ¡ƒ": "æ¡ƒ",
    "å¸«å‚…": "çº",
    "æ —å­": "æ —",
    "ç…è–©": "ç…",
    "å¤æœ¬": "å¤",
    "å…¶ä»–è§’è‰²": "å…¶"
  };

  // âœ… å•†å“ç¨®é¡é—œéµå­—å°æ‡‰
  const typeMap = {
    "è²¼ç´™è† å¸¶": ["è²¼ç´™"],
    "æ–‡å…·ç£éµ": ["æ–‡å…·", "ç£éµ"],
    "ç«‹ç‰Œå¾½ç« ": ["ç«‹ç‰Œ", "å¾½ç« "],
    "é‘°åŒ™åœˆå¾¡å®ˆ": ["é‘°åŒ™åœˆ", "å¾¡å®ˆ"],
    "ç©å…·ç›²æŠ½": ["ç©å…·", "ç›²"],
    "æœé£¾åŒ…è¢‹": ["åŒ…åŒ…", "è¡£æœ", "é£¾å“"],
    "ç”Ÿæ´»å±…å®¶": ["3C", "å±…å®¶", "æ¯›å·¾"],
    "é¤å»šç”¨å“": ["é¤å»š"]
  };

  fetch(url)
    .then(res => res.text())
    .then(t => JSON.parse(t.substr(47).slice(0, -2)))
    .then(data => {
      const rows = data.table.rows.slice(1);

      // âœ… å°‡è³‡æ–™è½‰ç‚ºç‰©ä»¶é™£åˆ—
      const items = rows.map(row => {
        const c = row.c;
        return {
          type: c[1]?.v || "",        // ç¨®é¡
          name: c[2]?.v || "",        // åç¨±
          role: c[0]?.v || "",        // è§’è‰²
          price: c[4]?.v || "",       // å”®åƒ¹
          stock: c[5]?.v || "",       // åº«å­˜
          nonStock: c[6]?.v || "",    // éç¾
          onShelf: c[7]?.v || "",     // ä¸Šæ¶
          acceptOrder: c[8]?.v || "", // å—æ³¨
          img: c[10]?.v || ""         // åœ–ç‰‡
        };
      });

      // âœ… æŒ‰è§’è‰²é †åºåˆ†çµ„è³‡æ–™
      const grouped = {};
      Object.keys(roleKeywords).forEach(r => grouped[r] = []);

      items.forEach(item => {
        if (item.onShelf && item.onShelf.toLowerCase() === "x") return; // ğŸš« ä¸Šæ¶æ¬„ x ä¸é¡¯ç¤º
        let roleName = Object.keys(roleKeywords).find(key =>
          item.role.includes(roleKeywords[key])
        );
        if (!roleName) roleName = "å…¶ä»–è§’è‰²"; // ğŸª§ ç„¡åŒ¹é…æ­¸å…¶ä»–è§’è‰²
        grouped[roleName].push(item);
      });

      const content = document.getElementById("content");
      content.innerHTML = "";

      // âœ… æŒ‰è§’è‰²é¡¯ç¤º
      for (const [roleName, roleItems] of Object.entries(grouped)) {
        if (roleItems.length === 0) continue;

        // ğŸ“Œ è§’è‰²æ¨™é¡Œ
        const sectionTitle = document.createElement("div");
        sectionTitle.className = "section-title";
        sectionTitle.textContent = roleName;
        content.appendChild(sectionTitle);

        // âœ… æŒ‰ç¨®é¡åˆ†çµ„
        const typeGroups = {};
        Object.keys(typeMap).forEach(t => typeGroups[t] = []);
        typeGroups["å…¶ä»–"] = [];

        roleItems.forEach(item => {
          let found = false;
          for (const [typeName, keywords] of Object.entries(typeMap)) {
            if (keywords.some(kw => item.type.includes(kw) || item.name.includes(kw))) {
              typeGroups[typeName].push(item);
              found = true;
              break;
            }
          }
          if (!found) typeGroups["å…¶ä»–"].push(item);
        });

        // âœ… é¡¯ç¤ºç¨®é¡åˆ†çµ„
        for (const [typeName, typeItems] of Object.entries(typeGroups)) {
          if (typeItems.length === 0) continue;

          // ğŸ“Œ ç¨®é¡åˆ†éš”ç·š
          const divider = document.createElement("div");
          divider.className = "type-divider";
          divider.textContent = typeName;
          content.appendChild(divider);

          // ğŸ“¦ å•†å“å¡å®¹å™¨
          const cardContainer = document.createElement("div");
          cardContainer.className = "card-container";

          typeItems.forEach(item => {
            // ğŸ· è²¨æ³åˆ¤æ–·
            let stockHtml = "";
            if (item.acceptOrder.toLowerCase() === "v") {
              stockHtml = `<span style="background:#74BDCB;color:#fff;padding:2px 8px;border-radius:12px;">å—æ³¨å“</span>`;
            } else if (parseInt(item.stock) > 0) {
              stockHtml = `<span style="background:#FFF4BD;color:#333;padding:2px 8px;border-radius:12px;">ç¾è²¨</span>`;
            } else if (item.stock == 0 && !item.nonStock) {
              stockHtml = `<span style="background:#D4BBDD;color:#333;padding:2px 8px;border-radius:12px;">éœ€é è¨‚</span>`;
            } else if (item.nonStock) {
              stockHtml = `<span style="background:#5885AF;color:#fff;padding:2px 8px;border-radius:12px;">æ­é£›æ©Ÿä¸­</span>`;
            } else {
              stockHtml = `<span style="background:#E7F2F8;color:#333;padding:2px 8px;border-radius:12px;">é»è²¨ä¸­</span>`;
            }

            // ğŸ›’ å•†å“å¡
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
              <img src="${item.img || 'https://i.postimg.cc/bv5xRs04/image.png'}" alt="${item.name}">
              <div class="stock">${stockHtml}</div>
              <div class="name">${item.name}</div>
              <div class="price">${item.price}</div>
            `;
            cardContainer.appendChild(card);
          });

          content.appendChild(cardContainer);
        }
      }
    })
    .catch(e => {
      document.getElementById("content").innerHTML = "è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
      console.error(e);
    });
</script>
</body>
</html>
