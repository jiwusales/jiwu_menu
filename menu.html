<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>JIWU寶寶目錄</title>
<style>
  :root {
    --role-color: #dac7b7;
  }

  body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    background-image: url('https://i.postimg.cc/Kj8V5YMg/2.png');
    background-repeat: repeat;
    background-size: 135px;
    margin: 0;
    padding: 0;
    color: #333;
    text-align: center;
  }

  .top-bar {
    background: var(--role-color);
    color: #fff;
    padding: 10px 0;
    position: sticky;
    top: 0;
    width: 100%;
    z-index: 999;
    font-weight: bold;
    user-select: none;
  }

  .top-bar a {
    color: #fff;
    text-decoration: underline;
    font-weight: bold;
    font-size: 16px;
    margin-left: 12px;
  }

  #product-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 12px;
    padding: 0 10px 20px;
    box-sizing: border-box;
    justify-items: center;
  }

  /* 分類分隔線跨滿整行，置中有實線 */
  .type-divider {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0 6px;
    font-weight: bold;
    font-size: 14px;
    color: #333;
    user-select: none;
  }

  .type-divider::before,
  .type-divider::after {
    content: "";
    flex: 1;
    border-top: 2px solid #333;
    margin: 0 12px;
  }

  /* 商品卡 a 或 div */
  .product {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 100px;
    border: 2px solid #ccc;
    border-radius: 8px;
    background-color: #fff;
    padding: 6px 4px 8px;
    box-sizing: border-box;
    user-select: none;
    cursor: pointer;
    text-decoration: none !important;
    color: #333 !important;
    transition: box-shadow 0.3s;
  }

  .product:hover {
    box-shadow: 0 0 0 2px var(--role-color);
  }

  .product img {
    width: 100%;
    height: auto;
    object-fit: contain;
    margin-bottom: 4px;
  }

  .status {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 8px;
  margin-bottom: 4px;
  display: inline-block;
  user-select: none;
  white-space: nowrap;
  }
  .status.instock { background-color: #FFF4BD; color: #333; }
  .status.preorder { background-color: #D4BBDD; color: #333; }
  .status.made { background-color: #74BDCB; color: #fff; }
  .status.flight { background-color: #5885AF; color: #fff; }
  .status.checking { background-color: #E7F2F8; color: #333; }

  .name, .price {
    font-size: 12px;
    height: 24px;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    line-height: 1.2;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    color: #333;
  }

  .name {
    font-weight: bold;
  }

  .bottom-bar {
    background-color: var(--role-color);
    color: #fff;
    text-align: center;
    padding: 10px 0;
    font-weight: bold;
    font-size: 14px;
    margin-top: 30px;
    user-select: none;
  }

  .bottom-bar a {
    color: #fff;
    text-decoration: underline;
  }

  .center-divider {
    width: 90vw;
    max-width: 1200px;
    border-top: 1px solid #333;
    margin: 10px auto 0;
    user-select: none;
  }

  @media (max-width: 767px) {
    #product-list {
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 12px 10px 20px;
    }

    .product {
      max-width: 80px;
      padding: 4px 2px 6px;
    }

    .name, .price {
      font-size: 10px;
    }
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #222;
      color: #eee;
    }

    .product {
      background-color: #fff;
      color: #333;
    }

    .name, .price {
      color: #333;
    }
  }
</style>
</head>
<body>
<header class="top-bar" id="header-text">
    <a href="https://lin.ee/X6FUFI9" target="_blank" rel="noopener">訂購這邊找花花 (৹˙꒳˙ฅ) </a>
</header>

<main id="product-list">載入中...</main>

<script>
  const roleConfig = {
    "吉伊": { field: "角色", keywords: ["吉"], color: "#d77485" },
    "小八": { field: "角色", keywords: ["八"], color: "#6293b8" },
    "兔兔": { field: "角色", keywords: ["兔"], color: "#f9be3c" },
    "小桃": { field: "角色", keywords: ["桃"], color: "#838BC2" },
    "師傅": { field: "角色", keywords: ["獺"], color: "#CCAFA5" },
    "栗子": { field: "角色", keywords: ["栗"], color: "#94C973" },
    "獅薩": { field: "角色", keywords: ["獅"], color: "#FBAA60" },
    "古本": { field: "角色", keywords: ["古"], color: "#eb9e97" },
    "其他角色": { field: "角色", keywords: ["其"], color: "#45818e" },
    "仙境": { field: "名稱", keywords: ["仙境"], color: "#985859" },
    "貼紙膠帶": { field: "種類", keywords: ["貼紙"], color: "#F8C0C8" },
    "文具磁鐵": { field: "種類", keywords: ["文具", "磁鐵"], color: "#BAD3E4" },
    "立牌徽章": { field: "種類", keywords: ["立牌", "徽章"], color: "#d5a6bd" },
    "鑰匙圈御守": { field: "種類", keywords: ["鑰匙圈", "御守"], color: "#7E9DC2" },
    "玩具盲抽": { field: "種類", keywords: ["玩具", "盲"], color: "#90ADC6" },
    "服飾包袋": { field: "種類", keywords: ["包包", "衣服", "飾品"], color: "#b4a7d6" },
    "生活居家": { field: "種類", keywords: ["3C", "居家", "毛巾"], color: "#98D7C2" },
    "餐廚用品": { field: "種類", keywords: ["餐廚"], color: "#F1A17E" },
    "小白虎黑虎蝦": { field: null, keywords: [], color: "#4f5474" },
    "ナガノ": { field: null, keywords: [], color: "#7f6a6f" },
    "カナヘラ": { field: null, keywords: [], color: "#a58b7e" }
  };

  const categoryOrder = [
    { label: "吊娃、娃", keywords: ["吊娃", "娃"] },
    { label: "包包", keywords: ["包"] },
    { label: "鑰匙圈、御守", keywords: ["鑰匙圈", "御守"] },
    { label: "立牌、徽章、磁鐵、玩具", keywords: ["立牌", "徽章", "磁鐵", "玩具"] },
    { label: "文具、貼紙", keywords: ["文具", "貼紙"] },
    { label: "3C、居家、毛巾", keywords: ["3C", "居家", "毛巾"] },
    { label: "飾品、衣服", keywords: ["飾品", "衣服"] },
    { label: "餐廚", keywords: ["餐廚"] }
  ];

  const spreadsheetId = "1iCEqgnGGa_TVVbx90xNWxDzwKtz94VfqF8IsXRvpKMY";

  const sheetURLs = {
    "吉伊": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "小八": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "兔兔": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "小桃": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "師傅": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "栗子": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "獅薩": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "古本": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "其他角色": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "仙境": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "貼紙膠帶": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "文具磁鐵": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "立牌徽章": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "鑰匙圈御守": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "玩具盲抽": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "服飾包袋": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "生活居家": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "餐廚用品": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "小白虎黑虎蝦": `https://opensheet.elk.sh/${spreadsheetId}/小白虎黑虎蝦`,
    "ナガノ": `https://opensheet.elk.sh/${spreadsheetId}/ナガノ`,
    "カナヘラ": `https://opensheet.elk.sh/${spreadsheetId}/カナヘラ`
  };

  const roleParam = new URLSearchParams(location.search).get("role") || "吉伊";
  const config = roleConfig[roleParam] || { field: null, keywords: [], color: "#ccc" };
  const sheetURL = sheetURLs[roleParam] || sheetURLs["吉伊"];

  document.documentElement.style.setProperty('--role-color', config.color);
  const container = document.getElementById("product-list");
  container.innerHTML = "載入中...";

  fetch(sheetURL)
    .then(res => {
      if (!res.ok) throw new Error("HTTP error " + res.status);
      return res.json();
    })
    .then(data => {
      const isChiiKawa = sheetURL.includes("/ちいかわ");

      // 篩選角色或種類符合的商品
      const filtered = data.filter(row => {
        if (row["上架"] === "x") return false;
        if (!config.field) return true;
        return config.keywords.some(k => (row[config.field] || "").includes(k));
      });

      if (filtered.length === 0) {
        container.innerHTML = "找不到符合條件的商品";
        return;
      }

      // 建立空陣列存分類商品
      const categorizedProducts = {};
      categoryOrder.forEach(cat => categorizedProducts[cat.label] = []);

      filtered.forEach(p => {
        let matched = false;
        for (let cat of categoryOrder) {
          if (cat.keywords.some(k => (p["種類"] || "").includes(k))) {
            categorizedProducts[cat.label].push(p);
            matched = true;
            break;
          }
        }
        if (!matched) {
          // 沒有分類就不放入（你可改成放在「其他」）
        }
      });

      container.innerHTML = "";

      categoryOrder.forEach(cat => {
        const items = categorizedProducts[cat.label];
        if (items.length === 0) return;

        // 加分類分隔線（左右實線＋置中文字）
        const divider = document.createElement("div");
        divider.className = "type-divider";
        divider.textContent = cat.label;
        container.appendChild(divider);

        items.forEach(p => {
          let status = "";
          let statusClass = "";

          if (isChiiKawa) {
            if ((p["受注"] || "").toLowerCase().includes("v")) {
              status = "受注品"; statusClass = "made";
            } else if (parseInt(p["庫存"]) > 0) {
              status = "現貨"; statusClass = "instock";
            } else if (p["庫存"] === "0" && !p["非現"]) {
              status = "需預訂"; statusClass = "preorder";
            } else if (p["庫存"] === "0" && p["非現"]) {
              status = "搭飛機中"; statusClass = "flight";
            } else {
              status = "點貨中"; statusClass = "checking";
            }
          }

          let price = "";
          let linkUrl = "https://lin.ee/X6FUFI9";

          if (p["售價"] === "-") {
            price = "組合出售";
            linkUrl += `?text=組合出售%20${encodeURIComponent(p["名稱"])}`;
          } else if (!p["售價"]) {
            price = "私訊花花";
            linkUrl += `?text=私訊花花%20${encodeURIComponent(p["名稱"])}`;
          } else {
            price = p["售價"];
            linkUrl = null; // 有售價的不設連結
          }

          let imageUrl = p["圖片"]?.trim() || "https://i.postimg.cc/XJSn6Jx1/image.png";

          const product = document.createElement(linkUrl ? "a" : "div");
          product.className = "product";
          if (linkUrl) {
            product.href = linkUrl;
            product.target = "_blank";
            product.rel = "noopener";
            product.style.borderColor = config.color;
          } else {
            product.style.borderColor = config.color;
          }

          product.innerHTML = `
            <img src="${imageUrl}" alt="">
            ${status ? `<div class="status ${statusClass}">${status}</div>` : ""}
            <div class="name" title="${p["名稱"]}">${p["名稱"]}</div>
            <div class="price">${price}</div>
          `;

          container.appendChild(product);
        });
      });
    })
    .catch(err => {
      container.innerHTML = "載入資料失敗";
      console.error(err);
    });
</script>
</body>
</html>
