<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>JIWU寶寶目錄</title>

<!-- 分頁小圖（favicon）-->
  <link rel="icon" href="https://i.postimg.cc/3R7nNT0k/icon.png" type="image/png" />
  
<style>
  /* 🌟 全域變數：角色色 */
  :root {
    --role-color: #dac7b7;
  }

  /* 🌟 網頁基礎樣式 */
  body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    background-image: url('https://i.postimg.cc/Kj8V5YMg/2.png');
    background-repeat: repeat;
    background-size: 135px;
    margin: 0;
    padding: 0;
    color: #333333;
    text-align: center;
  }

  /* 🌟 頂部bar樣式 */
  .top-bar {
    background: var(--role-color);
    color: #fff;
    padding: 10px 0;
    position: sticky;
    top: 0;
    width: 100%;
    z-index: 999;
    font-weight: bold;
    user-select: none;
  }

  .top-bar a {
    color: #fff;
    text-decoration: underline;
    font-weight: bold;
    font-size: 16px;
    margin-left: 12px;
  }

  /* 🌟 商品列表樣式 */
  #product-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 12px;
    padding: 0 10px 20px;
    box-sizing: border-box;
    justify-items: center;
  }

  /* 🌟 分類分隔線樣式 */
  .type-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0 6px;
    color: #333;
    font-weight: bold;
    font-size: 14px;
    gap: 12px;
    user-select: none;
  }

  .type-divider::before,
  .type-divider::after {
    content: "";
    flex-grow: 1;
    border-top: 1px solid #333;
    min-width: 30px;
    max-width: 50%;
  }

  /* 🌟 單一商品卡樣式 */
  .product {
    width: 100%;
    border: 2px solid #ccc;
    border-radius: 8px;
    background-color: #fff;
    padding: 6px 4px 8px;
    box-sizing: border-box;
    user-select: none;
    cursor: pointer;
    text-decoration: none !important;
    color: #333 !important;
    /* 🛠 移除 hover 邊框加粗 */
    transition: none;
  }

  /* 🌟 商品圖片樣式 */
  .product img {
    width: 100%;
    height: auto;
    object-fit: contain;
    margin-bottom: 4px;
  }

  /* 🌟 貨況標籤樣式 */
  .status {
    font-size: 10px;
    padding: 2px 12px;
    border-radius: 999px;
    margin-bottom: 4px;
    display: inline-block;
    user-select: none;
    white-space: nowrap;
  }
  .status.instock { background-color: #FFF4BD; color: #333333; }
  .status.preorder { background-color: #D4BBDD; color: #333333; }
  .status.made { background-color: #74BDCB; color: #ffffff; }
  .status.flight { background-color: #5885AF; color: #ffffff; }
  .status.checking { background-color: #E7F2F8; color: #333333; }

  /* 🌟 商品名稱與售價 */
  .name, .price {
    font-size: 12px;
    height: 24px;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    line-height: 1.2;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    color: #333;
  }

  .name {
    font-weight: bold;
  }

  /* 🌟 底部固定 bar 樣式 */
  .bottom-bar {
    background-color: var(--role-color);
    color: #fff;
    text-align: center;
    padding: 10px 0;
    font-weight: bold;
    font-size: 14px;
    margin-top: 30px;
    user-select: none;
  }

  .bottom-bar a {
    color: #fff;
    text-decoration: underline;
  }

  .center-divider {
    width: 90vw;
    max-width: 1200px;
    border-top: 1px solid #333;
    margin: 10px auto 0;
    user-select: none;
  }

  /* 🌟 手機版樣式 */
  @media (max-width: 767px) {
    #product-list {
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 12px 10px 20px;
    }

    .product {
      max-width: 82px;
      padding: 4px 2px 6px;
    }

    .product img {
      width: 80px;
    }

    .name, .price {
      font-size: 10px;
    }
  }

  /* 🌟 深色模式 */
  @media (prefers-color-scheme: dark) {
    body {
      background-color: #222;
      color: #eee;
    }

    .product {
      background-color: #fff;
      color: #333;
    }

    .name, .price {
      color: #333;
    }
  }
  .category-block {
  width: 100%;
  margin-bottom: 20px;
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 12px;
  justify-items: center;
}
</style>
</head>
<body>
  
  <!-- 🌟 頂部連結欄 -->
    <header class="top-bar" id="header-text">
    <a href="https://lin.ee/X6FUFI9" target="_blank" rel="noopener">訂購這邊找花花 (৹˙꒳˙ฅ) </a>
    </header>
  
  <!-- 🌟 商品列表主容器 -->
  <main id="product-list">載入中...</main>

<script>
  /* 🌟 角色配置：定義角色色與關鍵字 */
  const roleConfig = {
    "吉伊": { field: "角色", keywords: ["吉"], color: "#d77485" },
    "小八": { field: "角色", keywords: ["八"], color: "#6293b8" },
    "兔兔": { field: "角色", keywords: ["兔"], color: "#f9be3c" },
    "小桃": { field: "角色", keywords: ["桃"], color: "#838BC2" },
    "師傅": { field: "角色", keywords: ["獺"], color: "#CCAFA5" },
    "栗子": { field: "角色", keywords: ["栗"], color: "#94C973" },
    "獅薩": { field: "角色", keywords: ["獅"], color: "#FBAA60" },
    "古本": { field: "角色", keywords: ["古"], color: "#eb9e97" },
    "其他角色": { field: "角色", keywords: ["其"], color: "#45818e" },
    "仙境": { field: "名稱", keywords: ["仙境"], color: "#985859" },
    "貼紙膠帶": { field: "種類", keywords: ["貼紙"], color: "#F8C0C8" },
    "文具磁鐵": { field: "種類", keywords: ["文具", "磁鐵"], color: "#BAD3E4" },
    "立牌徽章": { field: "種類", keywords: ["立牌", "徽章"], color: "#d5a6bd" },
    "鑰匙圈御守": { field: "種類", keywords: ["鑰匙圈", "御守"], color: "#7E9DC2" },
    "玩具盲抽": { field: "種類", keywords: ["玩具", "盲"], color: "#90ADC6" },
    "服飾包袋": { field: "種類", keywords: ["包包", "衣服", "飾品"], color: "#b4a7d6" },
    "生活居家": { field: "種類", keywords: ["3C", "居家", "毛巾"], color: "#98D7C2" },
    "餐廚用品": { field: "種類", keywords: ["餐廚"], color: "#F1A17E" },
    "小白虎黑虎蝦": { field: null, keywords: [], color: "#4f5474" },
    "ナガノ": { field: null, keywords: [], color: "#68aad6" },
    "カナヘラ": { field: null, keywords: [], color: "#a58b7e" }
  };

  /* 🌟 分類順序配置 */
  const categoryOrder = [
    { label: "吊娃、娃", keywords: ["吊娃", "娃"] },
    { label: "包包", keywords: ["包"] },
    { label: "鑰匙圈、御守", keywords: ["鑰匙圈", "御守"] },
    { label: "立牌、徽章、磁鐵、玩具", keywords: ["立牌", "徽章", "磁鐵", "玩具"] },
    { label: "文具、貼紙", keywords: ["文具", "貼紙"] },
    { label: "3C、居家、毛巾", keywords: ["3C", "居家", "毛巾"] },
    { label: "飾品、衣服", keywords: ["飾品", "衣服"] },
    { label: "餐廚", keywords: ["餐廚"] }
  ];

  /* 🌟 Google Sheets API 設定 */
  const spreadsheetId = "1iCEqgnGGa_TVVbx90xNWxDzwKtz94VfqF8IsXRvpKMY";

  const sheetURLs = {
    "吉伊": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "小八": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "兔兔": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "小桃": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "師傅": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "栗子": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "獅薩": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "古本": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "其他角色": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "仙境": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "貼紙膠帶": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "文具磁鐵": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "立牌徽章": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "鑰匙圈御守": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "玩具盲抽": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "服飾包袋": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "生活居家": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "餐廚用品": `https://opensheet.elk.sh/${spreadsheetId}/ちいかわ`,
    "小白虎黑虎蝦": `https://opensheet.elk.sh/${spreadsheetId}/小白虎黑虎蝦`,
    "ナガノ": `https://opensheet.elk.sh/${spreadsheetId}/ナガノ`,
    "カナヘラ": `https://opensheet.elk.sh/${spreadsheetId}/カナヘラ`
  };

  /* 🌟 Google Sheets API 設定 */
  const roleParam = new URLSearchParams(location.search).get("role") || "吉伊";
  const config = roleConfig[roleParam] || { field: null, keywords: [], color: "#ccc" };
  const sheetURL = sheetURLs[roleParam] || sheetURLs["吉伊"];

document.documentElement.style.setProperty('--role-color', config.color);

  document.documentElement.style.setProperty('--role-color', config.color);

  const container = document.getElementById("product-list");
container.innerHTML = "載入中...";

  /* 🌟 載入資料並分類渲染商品 */
  fetch(sheetURL)
  .then(res => {
    if (!res.ok) throw new Error("HTTP error " + res.status);
    return res.json();
  })
  .then(data => {
  console.log("Raw data:", data);

  const filtered = data.filter(row => {
    if (row["上架"] === "x") return false;
    // 修改判斷：如果 config.field 不存在或關鍵字是空的，全部放行
    if (!config.field || config.keywords.length === 0) return true;
    // 有設定條件才比對
    return config.keywords.some(k => (row[config.field] || "").includes(k));
  });

  console.log("Filtered data:", filtered);

  if (filtered.length === 0) {
    container.innerHTML = "找不到符合條件的商品";
    return;
  }

    const categorizedProducts = {};
    categoryOrder.forEach(cat => categorizedProducts[cat.label] = []);

    filtered.forEach(p => {
      for (let cat of categoryOrder) {
        if (cat.keywords.some(k => (p["種類"] || "").includes(k))) {
          categorizedProducts[cat.label].push(p);
          break;
        }
      }
    });

    container.innerHTML = "";

    categoryOrder.forEach(cat => {
      const items = categorizedProducts[cat.label];
      if (items.length === 0) return;

      const categoryBlock = document.createElement("div");
      categoryBlock.className = "category-block";

      const divider = document.createElement("div");
      divider.className = "type-divider";
      divider.textContent = cat.label;
      categoryBlock.appendChild(divider);

      const productGrid = document.createElement("div");
      productGrid.className = "product-grid";

      items.forEach(p => {
        let status = "";
        let statusClass = "";

        if (sheetURL.includes("/ちいかわ")) {
          if ((p["受注"] || "").toLowerCase().includes("v")) {
            status = "受注品"; statusClass = "made";
          } else if (parseInt(p["庫存"]) > 0) {
            status = "現貨"; statusClass = "instock";
          } else if (p["庫存"] === "0" && !p["非現"]) {
            status = "需預訂"; statusClass = "preorder";
          } else if (p["庫存"] === "0" && p["非現"]) {
            status = "搭飛機中"; statusClass = "flight";
          } else {
            status = "點貨中"; statusClass = "checking";
          }
        }

        let price = "";
        let linkUrl = "https://lin.ee/X6FUFI9";

        if (p["售價"] === "-") {
          price = "組合出售";
          linkUrl += `?text=組合出售%20${encodeURIComponent(p["名稱"])}`;
        } else if (!p["售價"]) {
          price = "私訊花花";
          linkUrl += `?text=私訊花花%20${encodeURIComponent(p["名稱"])}`;
        } else {
          price = p["售價"];
          linkUrl = null;
        }

        let imageUrl = p["圖片"]?.trim() || "https://i.postimg.cc/XJSn6Jx1/image.png";

        const product = document.createElement(linkUrl ? "a" : "div");
        product.className = "product";
        if (linkUrl) {
          product.href = linkUrl;
          product.target = "_blank";
          product.rel = "noopener";
        }

        product.innerHTML = `
          <img src="${imageUrl}" alt="">
          ${status ? `<div class="status ${statusClass}">${status}</div>` : ""}
          <div class="name" title="${p["名稱"]}">${p["名稱"]}</div>
          <div class="price">${price}</div>
        `;
        productGrid.appendChild(product);
      });

      categoryBlock.appendChild(productGrid);
      container.appendChild(categoryBlock);
    });
  })
  .catch(err => {
    container.innerHTML = "載入資料失敗";
    console.error(err);
  });
</script>
</body>
</html>
