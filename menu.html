<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JIWU吉物寶寶圖鑑</title>

<link rel="icon" href="https://i.postimg.cc/3R7nNT0k/icon.png" type="image/png" />
<link rel="apple-touch-icon" href="https://i.postimg.cc/2ytNWwWL/image.png" />
<meta name="theme-color" content="#dac7b7" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<style>
  /* ====== 基本視覺 ====== */
  :root { --accent: #dac7b7; }
  body{
    font-family: Arial, sans-serif;
    margin:0;padding:0;text-align:center;color:#333;
    background:#f9f9f9 url('https://i.postimg.cc/Kj8V5YMg/2.png') repeat;
    background-size:135px;
  }
  /* ====== 頂端列 ====== */
  .top-bar{
    position:sticky;top:0;left:0;z-index:999;
    width:100%;padding:10px 0;background:var(--accent);color:#fff;font-weight:bold;
  }
  .top-bar a{color:#fff;text-decoration:underline;font-size:16px;margin-left:12px;}
  h1{margin:60px 0 10px;font-size:18px;user-select:none;}
  /* ====== 分頁按鈕 ====== */
  .tabs{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:20px 0 15px;}
  .tab{background:#dcdcdc;border:none;border-radius:20px;padding:6px 18px;cursor:pointer;
       font-weight:bold;font-size:14px;line-height:1.2;user-select:none;transition:.3s;}
  .tab.active{background:var(--accent);color:#fff}
  .center-divider{width:90vw;max-width:1200px;border-top:1px solid #333;margin:10px auto 0;}
  /* ====== 類別分隔線 ====== */
  .type-section{margin-bottom:18px;}
  .type-divider{
    display:flex;align-items:center;justify-content:center;
    margin:20px 0 6px;font-weight:bold;font-size:14px;user-select:none;color:#333;
    grid-column:1/-1; /* 塞在 grid 裏面時橫跨整行 */
  }
  .type-divider::before,.type-divider::after{
    content:"";flex:1;border-top:1.5px solid #333;margin:0 12px;
  }
  /* ====== 商品卡列表 (grid) ====== */
  #card-container{padding:0 10px 20px;display:grid;
    grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:12px;justify-items:center;}
  /* ====== 商品卡 ====== */
  .card{
    display:flex;flex-direction:column;align-items:center;
    width:100%;max-width:120px;background:#fff;border:2px solid #ccc;border-radius:8px;
    padding:6px 4px 8px;box-sizing:border-box;cursor:pointer;transition:.3s;color:#333;
    text-decoration:none!important;user-select:none;
  }
  .card:hover{box-shadow:0 0 0 2px var(--accent);}
  /* 手機固定 82/80px */
  @media (max-width:767px){
    .card{max-width:82px;padding:4px 2px 6px;}
    .card img{width:80px!important;}
    .name,.size{font-size:10px;}
  }
  .card img{width:100%;object-fit:contain;margin-bottom:4px;}
  .name,.size{font-size:12px;height:24px;display:flex;align-items:flex-end;justify-content:center;
    line-height:1.2;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:100%;}
  .name{font-weight:bold;}
  /* 收藏勾勾 */
  .checkmark{position:absolute;top:3px;right:3px;width:16px;height:16px;border-radius:50%;
    background:var(--accent);display:none;align-items:center;justify-content:center;}
  .checkmark svg{fill:#fff;width:10px;height:10px;}
  .card.collected .checkmark{display:flex;}
  /* ====== 底端列 ====== */
  .bottom-bar{background:var(--accent);color:#fff;padding:10px 0;font-weight:bold;margin-top:30px;}
  .bottom-bar a{color:#fff;text-decoration:underline;}
</style>
</head>
<body>
  <div class="top-bar">
    如資料有誤或缺漏請私訊
    <a href="https://lin.ee/X6FUFI9" target="_blank">JIWU吉物販售</a>
  </div>

  <h1>JIWU吉物販售．吉伊卡哇寶寶圖鑑</h1>

  <div class="tabs" id="tabs"></div>
  <div class="center-divider"></div>

  <div id="owned-count"></div>
  <div id="card-container"></div>

  <div class="bottom-bar">
    <a href="https://portaly.cc/jiwusales" target="_blank">歡迎追蹤按讚 (ෆ꒳´ෆ) JIWU吉物販售</a>
  </div>

<script>
/* ========== 基本設定 ========== */
const SHEET_ID="17gH9HZKvW_6fMCWYLyqnzMHj40rA7PiwWg6L0GvbFgQ";
const sheetNames=["吉伊","小八","兔兔","小桃","師傅","栗子","獅薩","古本","其他角色"];
const colors={
  "吉伊":"#d77485","小八":"#6293b8","兔兔":"#f9be3c","小桃":"#838BC2","師傅":"#CCAFA5",
  "栗子":"#94C973","獅薩":"#FBAA60","古本":"#eb9e97","其他角色":"#45818e"
};
const tabsContainer=document.getElementById("tabs");
const cardContainer=document.getElementById("card-container");
const ownedCountDiv=document.getElementById("owned-count");
let collected=JSON.parse(localStorage.getItem("collectedDolls"))||[];

/* ========== 建立分頁按鈕 ========== */
sheetNames.forEach(name=>{
  const tab=document.createElement("button");
  tab.className="tab";tab.textContent=name;
  tab.onclick=()=>switchTab(name);
  tabsContainer.appendChild(tab);
});
function switchTab(name){
  document.querySelectorAll(".tab").forEach(t=>t.classList.toggle("active",t.textContent===name));
  document.documentElement.style.setProperty("--accent",colors[name]||"#dac7b7");
  history.replaceState(null,"",`?tab=${encodeURIComponent(name)}`);
  loadSheet(name);
}
/* ========== 顯示已擁有數量 ========== */
function updateOwnedCount(list){
  const own=list.filter(i=>collected.includes(i.name)).length;
  ownedCountDiv.textContent=`(｡˃́⌔˂̀｡) 已擁有寶寶（${own} / ${list.length}）`;
}
/* ========== 讀取並渲染資料 ========== */
function loadSheet(name){
  cardContainer.textContent="載入中...";
  ownedCountDiv.textContent="";
  fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(name)}`)
  .then(r=>r.text()).then(t=>JSON.parse(t.slice(47,-2))).then(json=>{
    const rows=json.table.rows.slice(1); // 去掉標題
    const data=rows.map(r=>({
      type:r.c[0]?.v||"無類型",
      name:r.c[1]?.v||"",
      img:r.c[3]?.v||"",
      size:r.c[5]?.v||""
    }));
    render(data,name);
  }).catch(e=>{
    cardContainer.textContent="載入失敗";console.error(e);
  });
}
/* ========== 渲染畫面 ========== */
function render(list,sheet){
  cardContainer.innerHTML="";
  updateOwnedCount(list);
  const groups={};
  list.forEach(i=>{
    if(!groups[i.type])groups[i.type]=[];
    groups[i.type].push(i);
  });
  Object.keys(groups).forEach(type=>{
    const section=document.createElement("div");section.className="type-section";
    const divider=document.createElement("div");divider.className="type-divider";
    divider.innerHTML=`<span>${type}</span>`;section.appendChild(divider);

    const wrap=document.createElement("div");wrap.className="group-container";
    groups[type].forEach(item=>{
      const card=document.createElement("div");card.className="card";
      if(collected.includes(item.name)){card.classList.add("collected");card.style.borderColor=colors[sheet];}
      card.innerHTML=`
        <div class="checkmark"><svg viewBox="0 0 16 16"><path d="M6 11.2L3.3 8.5l-1.4 1.4L6 14 14 6l-1.4-1.4z"/></svg></div>
        <img src="${item.img||'https://i.postimg.cc/bv5xRs04/image.png'}" alt="${item.name}">
        <div class="name">${item.name}</div>
        <div class="size">${item.size}</div>`;
      card.onclick=()=>{
        const ck=card.querySelector(".checkmark");
        const on=!card.classList.toggle("collected");
        if(on){card.style.borderColor="#ccc";ck.style.display="none";collected=collected.filter(n=>n!==item.name);}
        else{card.style.borderColor=colors[sheet];ck.style.display="flex";collected.push(item.name);}
        localStorage.setItem("collectedDolls",JSON.stringify(collected));updateOwnedCount(list);
      };
      wrap.appendChild(card);
    });
    section.appendChild(wrap);
    cardContainer.appendChild(section);
  });
}

/* ========== 初始化 ========== */
const initTab=new URLSearchParams(location.search).get("tab")||sheetNames[0];
switchTab(initTab);
</script>
</body>
</html>
