<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JIWU吉物寶寶目錄</title>
  <link rel="icon" href="https://i.postimg.cc/3R7nNT0k/icon.png" type="image/png" />
  <meta name="theme-color" content="#4f5474" />
  <style>
    :root { --tab-color: #4f5474; }
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0; padding: 0;
      color: #333333;
      text-align: center;
    }
    .top-bar {
      background: var(--tab-color); color: #fff;
      padding: 10px 0; position: fixed; top: 0; left: 0; width: 100%;
      z-index: 999; user-select: none; font-size: 15px;
    }
    .top-bar .pulse-text {
      display: inline-block;
      animation: pulse 1.5s infinite;
    }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  .nav-bar-wrapper {
    position: fixed;
    top: 40px;
    width: 100%;
    background: #f9f9f9;
    display: flex;
    align-items: center;
    z-index: 998;
    padding: 0 5px;
    box-sizing: border-box;
    height: 40px;
  }
  .nav-bar-scroll {
    flex: 1;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .nav-bar-scroll::-webkit-scrollbar {
    display: none;
  }
  .nav-bar {
    display: inline-block;
    white-space: nowrap;
    padding: 10px 0;
    font-size: 10pt;
    color: #333;
  }
  .nav-bar a {
    color: #333;
    text-decoration: none;
    margin: 0px;
    padding-top: 6px;
    display: inline-block;
    font-weight: normal;
    -webkit-tap-highlight-color: transparent;
  }
  .nav-bar a::after {
    content: "｜";
    margin: 0px;
    color: #aaa;
    font-weight: normal;
    pointer-events: none;
  }
  .nav-bar a:last-child::after {
    content: "";
  }
  .nav-bar a:hover {
    font-weight: bold;
    color: var(--tab-color, #333);
  }
  .nav-link.active {
    font-weight: bold;
    color: var(--tab-color, #333333);
    text-decoration: none;
  }
  .nav-arrow {
    width: 28px;
    height: 28px;
    line-height: 28px;
    font-size: 18px;
    color: #333;
    background-color: transparent;
    border-radius: 0;
    text-align: center;
    user-select: none;
    cursor: pointer;
    flex-shrink: 0;
    margin: 0 6px;
    padding-top: 6px;
    transition: background-color 0.2s ease, color 0.2s ease;
    outline: none;
  }
  .nav-arrow:hover {
    background-color: transparent;
    color: var(--tab-color, #dac7b7);
  }
  .nav-bar a:focus,
  .nav-bar a:active {
    background-color: transparent !important;
    outline: none !important;
    box-shadow: none !important;
  }
  #card-container {
    padding: 80px 10px 6px 7px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin: 0;
  }
  .type-divider {
    display: flex; align-items: center; justify-content: center;
    margin: 8px 0; color: #333; font-weight: bold;
  }
  .type-divider::before, .type-divider::after {
    content: ""; flex: 1; border-top: 1px solid #333; margin: 0 10px;
  }
  .group-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, 120px);
    justify-content: start;
    gap: 6px;
  }
  @media (max-width: 480px) {
    .group-grid { grid-template-columns: repeat(4, 1fr); }
  }
  .card {
    width: 97%; max-width: 120px;
    border: 2px solid #ccc;
    border-radius: 8px;
    background-color: #fff;
    position: relative;
    text-align: center;
    color: #333;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-decoration: none;
    cursor: pointer;
  }
  .card img {
    display: block;
    margin: 5px auto 0 auto;
    width: 80px;
    object-fit: contain;
  }
  .card .name {
    margin: 1px auto; font-size: 9px; font-weight: bold; line-height: 1.2;
  }
  .card .price {
    font-size: 10px; margin: 1px auto 5px;
  }
  .status-badge {
    display: inline-block; border-radius: 12px;
    padding: 2px 6px; font-size: 10px; font-weight: bold;
    margin: 0 auto 4px auto;
  }
  @media (min-width: 768px) {
    .card { width: 120px; }
    .card img { width: 116px; }
    .card .name, .card .price { font-size: 12px; }
  }
  /* 點擊放大卡片 */
  .card.zoom {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) scale(2.5);
    z-index: 1050 !important;
    width: 240px !important;
    max-width: none !important;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    border-color: var(--tab-color) !important;
    border-radius: 12px !important;
    background-color: white !important;
    cursor: zoom-out !important;
  }
  #cardOverlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background-color: rgba(0,0,0,0.4);
    z-index: 1040;
    cursor: zoom-out;
    user-select: none;
  }
  #cardOverlay.active {
    display: block;
  }
  /* Modal 基本樣式 */
  .modal {
    display: none; 
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border: 2px solid #ccc;
    width: 90%;
    max-width: 700px;
    border-radius: 8px;
    text-align: left;
  }
  .close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close-btn:hover {
    color: #333;
  }
  .img-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0px;
    margin-bottom: 8px;
  }
  .img-container img {
    width: 140px;
    height: auto;
    border-radius: 0px;
    object-fit: contain;
  }
  .modal-content .combo-name,
  .modal-content .combo-price {
    color: #4E4F50;
  }
  /* 手機 2張2組一排 */
  .img-row-2 img {
    width: 50%;
    margin: 0;
    object-fit: contain;
  }
  /* 手機 4張一排 */
  .img-row-4 img {
    width: calc(100% / 4);
    margin: 0;
  }
  /* 手機 3張一排 */
  .img-row-3 img {
    width: calc(100% / 3);
    margin: 0;
  }
  /* 平板+電腦 6張一排 */
  @media (min-width: 768px) {
    .img-row-6 img {
      width: calc(100% / 6);
      margin: 0;
    }
  }
  /* 手機版 Modal 寬度調整 */
  @media (max-width: 480px) {
    .modal-content {
      width: 80% !important;
      max-width: none;
    }
  }
  </style>
</head>
<body>
  <div class="top-bar">
    <a href="https://lin.ee/X6FUFI9" target="_blank" rel="noopener noreferrer" style="color: #fff; text-decoration: none;">
      <span class="pulse-text">組合內容點擊卡片會跳出噢！訂購這邊找花花 (৹˙꒳˙ฅ )</span>
    </a>
  </div>
  <div id="card-container"></div>
  <div id="cardOverlay"></div>

  <div class="nav-bar-wrapper">
    <div class="nav-arrow nav-left">❮</div>
    <div class="nav-bar-scroll">
      <div class="nav-bar">
        <a class="nav-link" href="#吊娃．娃">吊娃．娃</a>
        <a class="nav-link" href="#包袋">包袋</a>
        <a class="nav-link" href="#文具．磁鐵">文具．磁鐵</a>
        <a class="nav-link" href="#貼紙">貼紙</a>
        <a class="nav-link" href="#鑰匙圈．御守">鑰匙圈．御守</a>
        <a class="nav-link" href="#立牌．徽章．玩具">立牌．徽章．玩具</a>
        <a class="nav-link" href="#生活居家">生活居家</a>
        <a class="nav-link" href="#餐廚">餐廚</a>
      </div>
    </div>
    <div class="nav-arrow nav-right">❯</div>
  </div>

  <!-- Modal for 組合內容 -->
  <div id="comboModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h2 id="comboTitle">組合內容</h2>
      <div id="comboBody">載入中...</div>
    </div>
  </div>

<script>
const SHEET_ID = "1iCEqgnGGa_TVVbx90xNWxDzwKtz94VfqF8IsXRvpKMY";
const sheetName = "小白虎黑虎蝦";

const categoryMap = {
  "吊娃": "吊娃．娃", "娃": "吊娃．娃",
  "包包": "包袋",
  "鑰匙圈": "鑰匙圈．御守", "御守": "鑰匙圈．御守",
  "立牌": "立牌．徽章．玩具", "徽章": "立牌．徽章．玩具", "玩具": "立牌．徽章．玩具", "盲": "立牌．徽章．玩具",
  "文具": "文具．磁鐵", "磁鐵": "文具．磁鐵", "貼紙": "貼紙",
  "3C": "生活居家", "居家": "生活居家", "毛巾": "生活居家",
  "餐廚": "餐廚",
};

const categoryOrder = [
  "吊娃．娃",
  "包袋",
  "鑰匙圈．御守",
  "文具．磁鐵",
  "貼紙",
  "立牌．徽章．玩具",
  "生活居家",
  "餐廚"
];

let roleOrder = [];

function loadSheetData() {
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
  fetch(url)
    .then(res => res.text())
    .then(text => JSON.parse(text.substr(47).slice(0, -2)))
    .then(data => {
      const rows = data.table.rows;
      let items = [];

      rows.forEach(row => {
        const role = row.c[0]?.v || "";
        const kind = row.c[1]?.v || "";
        const style = row.c[2]?.v || "";
        const name = row.c[3]?.v || "";
        const price = row.c[5]?.v || "";
        const stock = row.c[6]?.v || "";
        const notStock = row.c[7]?.v || "";
        const up = row.c[8]?.v || "";
        const preorder = row.c[9]?.v || "";
        const img = row.c[11]?.v || "https://i.postimg.cc/bv5xRs04/image.png";

        if (role && !roleOrder.includes(role)) {
          roleOrder.push(role);
        }

        const baseCategory = categoryMap[kind] || kind || "未分類";
        let categoriesToAdd = [baseCategory];
        if (kind === "娃") {
          if (style === "抱枕" && !categoriesToAdd.includes("生活居家")) {
            categoriesToAdd.push("生活居家");
          }
          if (style === "背包" && !categoriesToAdd.includes("包袋")) {
            categoriesToAdd.push("包袋");
          }
          if (style === "捲尺" && !categoriesToAdd.includes("文具．磁鐵")) {
            categoriesToAdd.push("文具．磁鐵");
          }
          if (style === "頸枕" && !categoriesToAdd.includes("生活居家")) {
            categoriesToAdd.push("生活居家");
          }
        }

        categoriesToAdd.forEach(cat => {
          items.push({ role, category: cat, style, name, price, stock, notStock, up, preorder, img });
        });
      });

      renderCards(items);
    })
    .catch(err => {
      document.getElementById("card-container").innerHTML = "載入資料失敗，請稍後再試。";
      console.error(err);
    });
}

function renderCards(items) {
  const container = document.getElementById("card-container");
  container.innerHTML = "";

  items.sort((a, b) => {
    const catA = categoryOrder.indexOf(a.category);
    const catB = categoryOrder.indexOf(b.category);
    return catA - catB;
  });

  let currentCategory = "";
  let groupDiv;

  items.forEach(item => {
    if (item.category !== currentCategory) {
      currentCategory = item.category;
      const divider = document.createElement("div");
      divider.className = "type-divider";
      divider.textContent = currentCategory;
      divider.id = currentCategory;
      divider.style.scrollMarginTop = "88px";
      container.appendChild(divider);

      groupDiv = document.createElement("div");
      groupDiv.className = "group-grid";
      container.appendChild(groupDiv);
    }

    const isCombo = item.price === "-";
    const link = (!item.price || isCombo) ? "https://lin.ee/X6FUFI9" : null;
    const wrapper = document.createElement(link && !isCombo ? "a" : "div");
    wrapper.className = "card";

    if (isCombo) {
      wrapper.style.cursor = "pointer";
      wrapper.onclick = () => {
        loadComboDetails(item.name);
      };
    } else if (link) {
      wrapper.href = link;
      wrapper.target = "_blank";
    }

    const img = document.createElement("img");
    img.src = item.img;
    img.alt = item.name;
    wrapper.appendChild(img);

    const nameDiv = document.createElement("div");
    nameDiv.className = "name";
    nameDiv.innerHTML = formatName(item.name);
    wrapper.appendChild(nameDiv);

    const priceDiv = document.createElement("div");
    priceDiv.className = "price";
    priceDiv.textContent = formatPrice(item.price);
    wrapper.appendChild(priceDiv);

    groupDiv.appendChild(wrapper);
  });
}

// 點擊放大功能
const cardOverlay = document.getElementById("cardOverlay");

function closeZoom() {
  const zoomedCard = document.querySelector(".card.zoom");
  if (zoomedCard) {
    zoomedCard.classList.remove("zoom");
  }
  cardOverlay.classList.remove("active");
}

document.getElementById("card-container").addEventListener("click", e => {
  let card = e.target.closest(".card");
  if (!card) return;

  if (card.classList.contains("zoom")) {
    closeZoom();
    return;
  }

  closeZoom();

  card.classList.add("zoom");
  cardOverlay.classList.add("active");
});

cardOverlay.addEventListener("click", closeZoom);

// Modal 組合內容相關略（用你原本的code）

function loadComboDetails(clickedItemName) {
  const modal = document.getElementById("comboModal");
  const body = document.getElementById("comboBody");
  document.getElementById("comboTitle").textContent = clickedItemName;
  body.innerHTML = "載入中...";
  modal.style.display = "block";

  // 這裡請填你的組合內容載入邏輯
}

document.querySelector(".close-btn").addEventListener("click", () => {
  document.getElementById("comboModal").style.display = "none";
});

// 小工具函數
function formatPrice(price) {
  if (!price) return "";
  if (price === "-") return "組合價";
  return "NT$ " + price;
}
function formatName(name) {
  return name.replace(/\n/g, "<br>");
}

loadSheetData();
</script>
</body>
</html>
